(()=>{"use strict";const t=class{constructor(t,e){this.name=t,this.length=e,this.health=e,this.coordinates=[],this.orientation=null}hit(){this.health-=1}isSunk(){return 0===this.health}},e=[{x:0,y:1},{x:1,y:0}];function n(t){return t[Math.floor(Math.random()*t.length)]}function o(){return`rgb(${255*Math.random()}, ${255*Math.random()}, ${255*Math.random()})`}function r([t,e],n){return t>=0&&t<n.length&&e>=0&&e<n.length}const a=document.querySelector(".player"),s=document.querySelector(".computer");function l(t,e){const n=document.createElement("div");return n.classList.add("cell"),n.dataset.x=t,n.dataset.y=e,n}function i(t){for(let e=0;e<8;++e)for(let n=0;n<8;++n){const o=l(e,n);t.appendChild(o)}}const c=class{static placeRandom(t,e){const n=[...t];for(;n.length>0;){const t=n.shift();this.tryToPlace(t,e)||n.push(t)}}static tryToPlace(t,o,r,a){r=r||function(t){const e=[];for(let n=0;n<t.length;++n)for(let o=0;o<t.length;++o)null===t[n][o]&&e.push([n,o]);return n(e)}(o),a=a||n(e);const s=t.coordinates;s.forEach((([t,e])=>{o[t][e]=null}));const l=this.#t(t.length,r,o,a);return l.length<t.length?(s.forEach((([e,n])=>o[e][n]=t)),!1):(t.coordinates=l,l.forEach((([e,n])=>o[e][n]=t)),t.orientation=a,!0)}static#t(t,e,n,o){const a=[];for(let s=0;s<t;++s){const t=e[0]+s*o.x,l=e[1]+s*o.y;r([t,l],n)&&null===n[t][l]&&a.push([t,l])}return a}},h=class{constructor(){this.boardSize=8,this.Ships=[new t("Hydra",5),new t("Pegasus",4),new t("Orion",3),new t("Scorpius",2),new t("Leo",1)],this.createboard(this.boardSize),this.placeShipsRandomly()}createboard(t){this.board=new Array(t).fill(null).map((()=>new Array(t).fill(null)))}placeShipsRandomly(){c.placeRandom(this.Ships,this.board)}placeShipAt(t,e,n){return c.tryToPlace(t,this.board,e,n)}areShipsSunk(){return!this.Ships.some((t=>!t.isSunk()))}receiveAttack([t,e]){return null!==this.board[t][e]&&(this.board[t][e].hit(),!0)}getShips(){return this.Ships}getBoard(){return this.board}};let u=null,d=null;const g=new Map;let p=null,y=null,f=null,m=null,x=!1,b=null;function S(t){y=t.target,y.classList.add("dragging"),y.style.removeProperty("background-color"),x=!0,f=t.clientX,m=t.clientY}function v(t){if(x){y.classList.remove("dragging"),y.classList.remove("notplaceable"),y.style.left="0px",y.style.top="0px";const t=b;t&&function(t,e){const n=[Number(t.dataset.x),Number(t.dataset.y)],o=g.get(e);return c.tryToPlace(o,p,n,o.orientation)}(t,y)?t.appendChild(y):g.get(y).coordinates.forEach((([t,e])=>p[t][e]=g.get(y)))}x=!1,y.style.backgroundColor=o(),M()}function E(t){x&&(g.get(y).coordinates.forEach((([t,e])=>p[t][e]=null)),y.style.left=t.clientX-f+"px",y.style.top=t.clientY-m+"px",b!==L()&&M(),b=L(),function(t){if(t){const e=g.get(y).length,n=function(t,e){const n=[];if(!t)return n;const o=Number(t.dataset.x),r=Number(t.dataset.y),a=g.get(y).orientation;for(let t=0;t<e;++t){const e=o+t*a.x,s=r+t*a.y,l=document.querySelector(`[data-x="${e}"][data-y="${s}"]`);l&&null===p[e][s]&&n.push(l)}return n}(t,e);if(n.length===e)return n.forEach((t=>{t.classList.add("highlight")})),void y.classList.remove("notplaceable")}y.classList.add("notplaceable")}(b))}function w(t){if(2===t.button){const e=60,n=t.target,o=g.get(n),r={x:1-o.orientation.x,y:1-o.orientation.y};c.tryToPlace(o,p,o.coordinates[0],r),n.style.width=`${Math.max(e,o.orientation.y*o.length*e)}px`,n.style.height=`${Math.max(e,o.orientation.x*o.length*e)}px`}}function L(){let t=1/0;return d.forEach((e=>{const n=Math.abs(e.getBoundingClientRect().x-y.getBoundingClientRect().x)+Math.abs(e.getBoundingClientRect().y-y.getBoundingClientRect().y);n<t&&(b=e,t=n)})),t>60?null:b}function M(){document.querySelectorAll(".highlight").forEach((t=>{t.classList.remove("highlight")}))}i(a),i(s),function(t){var e;u=document.querySelector(".player"),d=document.querySelectorAll(".player .cell"),p=t.getBoard(),e=t.getShips(),g.clear(),e.forEach((t=>{const e=function(t){const e=document.createElement("div");return e.classList.add("ship",t.name),e.style.backgroundColor=o(),e.style.top="0px",e.style.left="0px",e.style.width=`${Math.max(60,t.orientation.y*t.length*60)}px`,e.style.height=`${Math.max(60,t.orientation.x*t.length*60)}px`,e}(t);g.set(e,t);const[n,r]=t.coordinates[0];u.querySelector(`[data-x="${n}"][data-y="${r}"]`).appendChild(e)}));for(const t of g.keys())t.addEventListener("mousedown",S),t.addEventListener("mouseup",v),t.addEventListener("mouseup",w);document.addEventListener("mousemove",E),u.addEventListener("contextmenu",(t=>t.preventDefault()))}(new class{constructor(t){this.name=t,this.gameboard=new h}}("player").gameboard)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FxQjdCRyxFQUFPbUQsUUFFUGpGLEVBQU1XLFNBQVNULElBQ1osTUFBTThDLEVIbkJaLFNBQTZCOUMsR0FDMUIsTUFDTThDLEVBQWdCL0QsU0FBU08sY0FBYyxPQWU3QyxPQWJBd0QsRUFBY3ZELFVBQVVDLElBQUksT0FBUVEsRUFBS3JDLE1BQ3pDbUYsRUFBY1IsTUFBTVksZ0JBQWtCdkUsSUFDdENtRSxFQUFjUixNQUFNTyxJQUFNLE1BQzFCQyxFQUFjUixNQUFNTSxLQUFPLE1BQzNCRSxFQUFjUixNQUFNK0IsTUFBUSxHQUFHN0YsS0FBSzhGLElBUG5CLEdBU2R0RSxFQUFLaEMsWUFBWUssRUFBSTJCLEVBQUtwQyxPQVRaLFFBV2pCa0YsRUFBY1IsTUFBTWlDLE9BQVMsR0FBRy9GLEtBQUs4RixJQVhwQixHQWFkdEUsRUFBS2hDLFlBQVlJLEVBQUk0QixFQUFLcEMsT0FiWixRQWdCVmtGLENBQ1YsQ0dDNEJrQyxDQUFvQmhGLEdBQzFDNEIsRUFBT3FELElBQUluQyxFQUFlOUMsR0FDMUIsTUFBTzVCLEVBQUdDLEdBQUsyQixFQUFLakMsWUFBWSxHQUNuQixFQUFZaUIsY0FBYyxZQUFZWixlQUFlQyxPQUM3RHVCLFlBQVlrRCxFQUFjLElBMUJsQyxJQUFLLE1BQU1BLEtBQWlCbEIsRUFBT3NELE9BQ2hDcEMsRUFBY3FDLGlCQUFpQixZQUFhaEQsR0FDNUNXLEVBQWNxQyxpQkFBaUIsVUFBV3pDLEdBQzFDSSxFQUFjcUMsaUJBQWlCLFVBQVdsQixHQUc3Q2xGLFNBQVNvRyxpQkFBaUIsWUFBYS9CLEdBQ3ZDLEVBQVkrQixpQkFBaUIsZUFBZ0IvQyxHQUFNQSxFQUFFZ0Qsa0JBQ3hELENDdkJBQyxDQURlLElDSmYsTUFDSSxXQUFBM0gsQ0FBWUMsR0FDUkUsS0FBS0YsS0FBT0EsRUFDWkUsS0FBS2lILFVBQVksSUFBSSxDQUN6QixHREFzQixVQUNKQSxVIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvc2hpcC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy91dGlscy5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy9kb20uanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvc2hpcFBsYWNlbWVudEhhbmRsZXIuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL2RyYWdfZHJvcC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvcGxheWVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFNoaXAge1xuICAgY29uc3RydWN0b3IobmFtZSwgbGVuZ3RoKSB7XG4gICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7XG4gICAgICB0aGlzLmhlYWx0aCA9IGxlbmd0aDtcbiAgICAgIHRoaXMuY29vcmRpbmF0ZXMgPSBbXTtcbiAgICAgIHRoaXMub3JpZW50YXRpb24gPSBudWxsO1xuICAgfVxuXG4gICBoaXQoKSB7XG4gICAgICB0aGlzLmhlYWx0aCAtPSAxO1xuICAgfVxuXG4gICBpc1N1bmsoKSB7XG4gICAgICByZXR1cm4gdGhpcy5oZWFsdGggPT09IDA7XG4gICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNoaXA7XG4iLCJpbXBvcnQgU2hpcCBmcm9tIFwiLi9zaGlwXCI7XG5cbmNvbnN0IGhvcml6b250YWwgPSB7XG4gICB4OiAwLFxuICAgeTogMVxufTtcblxuY29uc3QgdmVydGljYWwgPSB7XG4gICB4OiAxLFxuICAgeTogMFxufTtcblxuY29uc3QgZGlycyA9IFtob3Jpem9udGFsLCB2ZXJ0aWNhbF07XG5cbmZ1bmN0aW9uIHNlbGVjdFJhbmRvbShhcnJheSkge1xuICAgY29uc3QgcmFuZG9tTnVtID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXJyYXkubGVuZ3RoKTtcbiAgIHJldHVybiBhcnJheVtyYW5kb21OdW1dO1xufVxuXG5mdW5jdGlvbiBnZXRSYW5kb21EaXJlY3Rpb24oKSB7XG4gICByZXR1cm4gc2VsZWN0UmFuZG9tKGRpcnMpO1xufVxuXG5mdW5jdGlvbiBnZXRSYW5kb21FbXB0eUNlbGwoYm9hcmQpIHtcbiAgIGNvbnN0IGVtcHR5Q2VsbHMgPSBbXTtcblxuICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7ICsraSkge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBib2FyZC5sZW5ndGg7ICsraikge1xuICAgICAgICAgaWYgKGJvYXJkW2ldW2pdID09PSBudWxsKSB7XG4gICAgICAgICAgICBlbXB0eUNlbGxzLnB1c2goW2ksIGpdKTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cblxuICAgcmV0dXJuIHNlbGVjdFJhbmRvbShlbXB0eUNlbGxzKTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVTaGlwcygpe1xuICAgIGNvbnN0IFNoaXBzID0gW1xuICAgICAgIG5ldyBTaGlwKCdIeWRyYScsIDUpLFxuICAgICAgIG5ldyBTaGlwKCdQZWdhc3VzJywgNCksXG4gICAgICAgbmV3IFNoaXAoJ09yaW9uJywgMyksXG4gICAgICAgbmV3IFNoaXAoJ1Njb3JwaXVzJywgMiksXG4gICAgICAgbmV3IFNoaXAoJ0xlbycsIDEpXG4gICAgXTtcblxuICAgIHJldHVybiBTaGlwcztcbn1cblxuZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKSB7XG4gICBjb25zdCBjb2xvciA9IGByZ2IoJHtNYXRoLnJhbmRvbSgpICogMjU1fSwgJHtNYXRoLnJhbmRvbSgpICogMjU1fSwgJHtcbiAgICAgIE1hdGgucmFuZG9tKCkgKiAyNTVcbiAgIH0pYDtcbiAgIFxuICAgcmV0dXJuIGNvbG9yO1xufVxuXG5mdW5jdGlvbiBjaGVja0JvdW5kKFt4LCB5XSwgYm9hcmQpIHtcbiAgIHJldHVybiB4ID49IDAgJiYgeCA8IGJvYXJkLmxlbmd0aCAmJiB5ID49IDAgJiYgeSA8IGJvYXJkLmxlbmd0aDtcbn1cblxuZXhwb3J0IHsgZ2V0UmFuZG9tRW1wdHlDZWxsLCBnZXRSYW5kb21EaXJlY3Rpb24sIGdlbmVyYXRlU2hpcHMsIGdldFJhbmRvbUNvbG9yLCBjaGVja0JvdW5kIH07XG4iLCJpbXBvcnQgeyBnZXRSYW5kb21Db2xvciB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBwbGF5ZXJCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXInKTtcbmNvbnN0IGNvbXB1dGVyQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29tcHV0ZXInKTtcblxuY29uc3QgZ3JpZFNpemUgPSA4O1xuXG5mdW5jdGlvbiBjcmVhdGVDZWxsKGksIGopIHtcbiAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnY2VsbCcpO1xuICAgY2VsbC5kYXRhc2V0LnggPSBpO1xuICAgY2VsbC5kYXRhc2V0LnkgPSBqO1xuXG4gICByZXR1cm4gY2VsbDtcbn1cblxuZnVuY3Rpb24gY3JlYXRlR3JpZChjb250YWluZXIpIHtcbiAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JpZFNpemU7ICsraSkge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBncmlkU2l6ZTsgKytqKSB7XG4gICAgICAgICBjb25zdCBjZWxsID0gY3JlYXRlQ2VsbChpLCBqKTtcbiAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICAgIH1cbiAgIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlU2hpcENvbXBvbmVudChzaGlwKSB7XG4gICBjb25zdCBjZWxsU2l6ZSA9IDYwO1xuICAgY29uc3Qgc2hpcENvbXBvbmVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gICBzaGlwQ29tcG9uZW50LmNsYXNzTGlzdC5hZGQoJ3NoaXAnLCBzaGlwLm5hbWUpO1xuICAgc2hpcENvbXBvbmVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBnZXRSYW5kb21Db2xvcigpO1xuICAgc2hpcENvbXBvbmVudC5zdHlsZS50b3AgPSAnMHB4JztcbiAgIHNoaXBDb21wb25lbnQuc3R5bGUubGVmdCA9ICcwcHgnO1xuICAgc2hpcENvbXBvbmVudC5zdHlsZS53aWR0aCA9IGAke01hdGgubWF4KFxuICAgICAgY2VsbFNpemUsXG4gICAgICBzaGlwLm9yaWVudGF0aW9uLnkgKiBzaGlwLmxlbmd0aCAqIGNlbGxTaXplXG4gICApfXB4YDtcbiAgIHNoaXBDb21wb25lbnQuc3R5bGUuaGVpZ2h0ID0gYCR7TWF0aC5tYXgoXG4gICAgICBjZWxsU2l6ZSxcbiAgICAgIHNoaXAub3JpZW50YXRpb24ueCAqIHNoaXAubGVuZ3RoICogY2VsbFNpemVcbiAgICl9cHhgO1xuXG4gICByZXR1cm4gc2hpcENvbXBvbmVudDtcbn1cblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgIGNyZWF0ZUdyaWQocGxheWVyQm9hcmQpO1xuICAgY3JlYXRlR3JpZChjb21wdXRlckJvYXJkKTtcbn1cblxuZXhwb3J0IHsgaW5pdCwgY3JlYXRlU2hpcENvbXBvbmVudCB9O1xuIiwiaW1wb3J0IHsgZ2V0UmFuZG9tRW1wdHlDZWxsLCBnZXRSYW5kb21EaXJlY3Rpb24sIGNoZWNrQm91bmQgfSBmcm9tICcuL3V0aWxzJztcblxuY2xhc3MgUGxhY2VtZW50SGFuZGxlciB7XG4gICBzdGF0aWMgcGxhY2VSYW5kb20oU2hpcHMsIGJvYXJkKSB7XG4gICAgICBjb25zdCBxdWV1ZSA9IFsuLi5TaGlwc107XG5cbiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICBjb25zdCBzaGlwID0gcXVldWUuc2hpZnQoKTtcblxuICAgICAgICAgY29uc3QgaXNTaGlwUGxhY2VkID0gdGhpcy50cnlUb1BsYWNlKHNoaXAsIGJvYXJkKTtcblxuICAgICAgICAgaWYgKCFpc1NoaXBQbGFjZWQpIHF1ZXVlLnB1c2goc2hpcCk7XG4gICAgICB9XG4gICB9XG5cbiAgIHN0YXRpYyB0cnlUb1BsYWNlKHNoaXAsIGJvYXJkLCBzdHJ0Q2VsbCwgZGlyKSB7XG4gICAgICBzdHJ0Q2VsbCA9IHN0cnRDZWxsIHx8IGdldFJhbmRvbUVtcHR5Q2VsbChib2FyZCk7XG4gICAgICBkaXIgPSBkaXIgfHwgZ2V0UmFuZG9tRGlyZWN0aW9uKCk7XG5cbiAgICAgIGNvbnN0IHByZXZDb29yZHMgPSBzaGlwLmNvb3JkaW5hdGVzO1xuXG4gICAgICBwcmV2Q29vcmRzLmZvckVhY2goKFt4LCB5XSkgPT4ge1xuICAgICAgICAgYm9hcmRbeF1beV0gPSBudWxsO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IG5ld0Nvb3JkcyA9IHRoaXMuI2dldE5ld0Nvb3JkaW5hdGVzKHNoaXAubGVuZ3RoLCBzdHJ0Q2VsbCwgYm9hcmQsIGRpcik7XG5cbiAgICAgIGlmIChuZXdDb29yZHMubGVuZ3RoIDwgc2hpcC5sZW5ndGgpIHtcbiAgICAgICAgIHByZXZDb29yZHMuZm9yRWFjaCgoW3gsIHldKSA9PiAoYm9hcmRbeF1beV0gPSBzaGlwKSk7XG4gICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHNoaXAuY29vcmRpbmF0ZXMgPSBuZXdDb29yZHM7XG4gICAgICBuZXdDb29yZHMuZm9yRWFjaCgoW3gsIHldKSA9PiAoYm9hcmRbeF1beV0gPSBzaGlwKSk7XG4gICAgICBzaGlwLm9yaWVudGF0aW9uID0gZGlyO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICB9XG5cbiAgIHN0YXRpYyAjZ2V0TmV3Q29vcmRpbmF0ZXMobGVuZ3RoLCBzdHJ0Q2VsbCwgYm9hcmQsIGRpcil7XG4gICAgY29uc3QgY2VsbHMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAgICBjb25zdCBwb3NYID0gc3RydENlbGxbMF0gKyBpICogZGlyLng7XG4gICAgICAgY29uc3QgcG9zWSA9IHN0cnRDZWxsWzFdICsgaSAqIGRpci55O1xuXG4gICAgICAgaWYgKGNoZWNrQm91bmQoW3Bvc1gsIHBvc1ldLCBib2FyZCkgJiYgYm9hcmRbcG9zWF1bcG9zWV0gPT09IG51bGwpIHtcbiAgICAgICAgICBjZWxscy5wdXNoKFtwb3NYLCBwb3NZXSk7XG4gICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjZWxscztcbiAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUGxhY2VtZW50SGFuZGxlcjtcbiIsImltcG9ydCBQbGFjZW1lbnRIYW5kbGVyIGZyb20gJy4vc2hpcFBsYWNlbWVudEhhbmRsZXInO1xuaW1wb3J0IHsgZ2VuZXJhdGVTaGlwcyB9IGZyb20gJy4vdXRpbHMnO1xuXG5jbGFzcyBHYW1lQm9hcmQge1xuICAgY29uc3RydWN0b3IoKSB7XG4gICAgICB0aGlzLmJvYXJkU2l6ZSA9IDg7XG4gICAgICB0aGlzLlNoaXBzID0gZ2VuZXJhdGVTaGlwcygpO1xuICAgICAgdGhpcy5jcmVhdGVib2FyZCh0aGlzLmJvYXJkU2l6ZSk7XG4gICAgICB0aGlzLnBsYWNlU2hpcHNSYW5kb21seSgpO1xuICAgfVxuXG4gICBjcmVhdGVib2FyZChzaXplKSB7XG4gICAgICB0aGlzLmJvYXJkID0gbmV3IEFycmF5KHNpemUpXG4gICAgICAgICAuZmlsbChudWxsKVxuICAgICAgICAgLm1hcCgoKSA9PiBuZXcgQXJyYXkoc2l6ZSkuZmlsbChudWxsKSk7XG4gICB9XG5cbiAgIHBsYWNlU2hpcHNSYW5kb21seSgpIHtcbiAgICAgIFBsYWNlbWVudEhhbmRsZXIucGxhY2VSYW5kb20odGhpcy5TaGlwcywgdGhpcy5ib2FyZCk7XG4gICB9XG5cbiAgIHBsYWNlU2hpcEF0KHNoaXAsIHN0cnRDZWxsLCBkaXIpIHtcbiAgICAgIHJldHVybiBQbGFjZW1lbnRIYW5kbGVyLnRyeVRvUGxhY2Uoc2hpcCwgdGhpcy5ib2FyZCwgc3RydENlbGwsIGRpcik7XG4gICB9XG5cbiAgIGFyZVNoaXBzU3VuaygpIHtcbiAgICAgIHJldHVybiAhdGhpcy5TaGlwcy5zb21lKChzaGlwKSA9PiAhc2hpcC5pc1N1bmsoKSk7XG4gICB9XG5cbiAgIHJlY2VpdmVBdHRhY2soW3gsIHldKSB7XG4gICAgICBpZiAodGhpcy5ib2FyZFt4XVt5XSA9PT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICBjb25zdCBzaGlwID0gdGhpcy5ib2FyZFt4XVt5XTtcbiAgICAgIHNoaXAuaGl0KCk7XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgfVxuXG4gICBnZXRTaGlwcygpIHtcbiAgICAgIHJldHVybiB0aGlzLlNoaXBzO1xuICAgfVxuXG4gICBnZXRCb2FyZCgpe1xuICAgICAgcmV0dXJuIHRoaXMuYm9hcmQ7XG4gICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVCb2FyZDtcbiIsImltcG9ydCB7IGdldFJhbmRvbUNvbG9yIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBjcmVhdGVTaGlwQ29tcG9uZW50IH0gZnJvbSAnLi9kb20nO1xuaW1wb3J0IFBsYWNlbWVudEhhbmRsZXIgZnJvbSAnLi9zaGlwUGxhY2VtZW50SGFuZGxlcic7XG5cbmxldCBwbGF5ZXJCb2FyZCA9IG51bGw7XG5sZXQgQ2VsbHMgPSBudWxsO1xuY29uc3QgbWFwcGVyID0gbmV3IE1hcCgpO1xuXG5sZXQgYm9hcmQgPSBudWxsO1xubGV0IGN1cnJTaGlwID0gbnVsbDtcbmxldCBpbml0aWFsWCA9IG51bGw7XG5sZXQgaW5pdGlhbFkgPSBudWxsO1xubGV0IGlzZHJhZ2dpbmcgPSBmYWxzZTtcbmxldCBzdGFydENlbGwgPSBudWxsO1xuXG5mdW5jdGlvbiBlbmFibGVEcmFnRHJvcChnYW1lYm9hcmQpIHtcbiAgIHBsYXllckJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllcicpO1xuICAgQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGxheWVyIC5jZWxsJyk7XG5cbiAgIGJvYXJkID0gZ2FtZWJvYXJkLmdldEJvYXJkKCk7XG4gICBpbml0U2hpcENvbXBvbmVudHMoZ2FtZWJvYXJkLmdldFNoaXBzKCkpO1xuXG4gICBmb3IgKGNvbnN0IHNoaXBDb21wb25lbnQgb2YgbWFwcGVyLmtleXMoKSkge1xuICAgICAgc2hpcENvbXBvbmVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBoYW5kbGVEcmFnU3RhcnQpO1xuICAgICAgc2hpcENvbXBvbmVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlRHJhZ0VuZCk7XG4gICAgICBzaGlwQ29tcG9uZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCByb3RhdGVTaGlwKTtcbiAgIH1cblxuICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgaGFuZGxlRHJhZ2dpbmcpO1xuICAgcGxheWVyQm9hcmQuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCAoZSkgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcbn1cblxuZnVuY3Rpb24gZGlzYWJsZURyYWdEcm9wKCl7XG4gICAgZm9yIChjb25zdCBzaGlwQ29tcG9uZW50IG9mIG1hcHBlci5rZXlzKCkpIHtcbiAgICAgICBzaGlwQ29tcG9uZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGhhbmRsZURyYWdTdGFydCk7XG4gICAgICAgc2hpcENvbXBvbmVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlRHJhZ0VuZCk7XG4gICAgICAgc2hpcENvbXBvbmVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgcm90YXRlU2hpcCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBpbml0U2hpcENvbXBvbmVudHMoU2hpcHMpIHtcbiAgIG1hcHBlci5jbGVhcigpO1xuXG4gICBTaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgICBjb25zdCBzaGlwQ29tcG9uZW50ID0gY3JlYXRlU2hpcENvbXBvbmVudChzaGlwKTtcbiAgICAgIG1hcHBlci5zZXQoc2hpcENvbXBvbmVudCwgc2hpcCk7XG4gICAgICBjb25zdCBbeCwgeV0gPSBzaGlwLmNvb3JkaW5hdGVzWzBdO1xuICAgICAgY29uc3QgY2VsbCA9IHBsYXllckJvYXJkLnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXg9XCIke3h9XCJdW2RhdGEteT1cIiR7eX1cIl1gKTtcbiAgICAgIGNlbGwuYXBwZW5kQ2hpbGQoc2hpcENvbXBvbmVudCk7XG4gICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRHJhZ1N0YXJ0KGUpIHtcbiAgIGN1cnJTaGlwID0gZS50YXJnZXQ7XG4gICBjdXJyU2hpcC5jbGFzc0xpc3QuYWRkKCdkcmFnZ2luZycpO1xuICAgY3VyclNoaXAuc3R5bGUucmVtb3ZlUHJvcGVydHkoJ2JhY2tncm91bmQtY29sb3InKTtcbiAgIFxuICAgaXNkcmFnZ2luZyA9IHRydWU7XG4gICBpbml0aWFsWCA9IGUuY2xpZW50WDtcbiAgIGluaXRpYWxZID0gZS5jbGllbnRZO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEcmFnRW5kKGUpIHtcbiAgIGlmIChpc2RyYWdnaW5nKSB7XG4gICAgICBjdXJyU2hpcC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpO1xuICAgICAgY3VyclNoaXAuY2xhc3NMaXN0LnJlbW92ZSgnbm90cGxhY2VhYmxlJyk7XG4gICAgICBjdXJyU2hpcC5zdHlsZS5sZWZ0ID0gJzBweCc7XG4gICAgICBjdXJyU2hpcC5zdHlsZS50b3AgPSAnMHB4JztcblxuICAgICAgY29uc3QgY2VsbCA9IHN0YXJ0Q2VsbDtcbiAgICAgIGlmICghY2VsbCB8fCAhaXNQbGFjZWFibGUoY2VsbCwgY3VyclNoaXApKSB7XG4gICAgICAgICBjb25zdCBwcmV2Q29vcmRzID0gbWFwcGVyLmdldChjdXJyU2hpcCkuY29vcmRpbmF0ZXM7XG4gICAgICAgICBwcmV2Q29vcmRzLmZvckVhY2goKFt4LCB5XSkgPT4gKGJvYXJkW3hdW3ldID0gbWFwcGVyLmdldChjdXJyU2hpcCkpKTsgIFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgIGNlbGwuYXBwZW5kQ2hpbGQoY3VyclNoaXApO1xuICAgICAgfVxuICAgfVxuXG4gICBpc2RyYWdnaW5nID0gZmFsc2U7XG4gICBjdXJyU2hpcC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBnZXRSYW5kb21Db2xvcigpO1xuICAgY2xlYXJIaWdobGlnaHQoKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRHJhZ2dpbmcoZSkge1xuICAgaWYgKGlzZHJhZ2dpbmcpIHtcbiAgICAgIGNvbnN0IHByZXZDb29yZHMgPSBtYXBwZXIuZ2V0KGN1cnJTaGlwKS5jb29yZGluYXRlcztcbiAgICAgIHByZXZDb29yZHMuZm9yRWFjaCgoW3gsIHldKSA9PiAoYm9hcmRbeF1beV0gPSBudWxsKSk7XG5cbiAgICAgIGN1cnJTaGlwLnN0eWxlLmxlZnQgPSBgJHtlLmNsaWVudFggLSBpbml0aWFsWH1weGA7XG4gICAgICBjdXJyU2hpcC5zdHlsZS50b3AgPSBgJHtlLmNsaWVudFkgLSBpbml0aWFsWX1weGA7XG5cbiAgICAgIGlmIChzdGFydENlbGwgIT09IGZpbmRTdGFydENlbGwoKSkge1xuICAgICAgICAgY2xlYXJIaWdobGlnaHQoKTtcbiAgICAgIH1cblxuICAgICAgc3RhcnRDZWxsID0gZmluZFN0YXJ0Q2VsbCgpO1xuICAgICAgaGlnaGxpZ2h0Q2VsbHMoc3RhcnRDZWxsKTtcbiAgIH1cbn1cblxuZnVuY3Rpb24gcm90YXRlU2hpcChlKSB7XG4gICBpZiAoZS5idXR0b24gPT09IDIpIHtcbiAgICAgIGNvbnN0IGNlbGxTaXplID0gNjA7XG4gICAgICBjb25zdCBzaGlwQ29tcG9uZW50ID0gZS50YXJnZXQ7XG4gICAgICBjb25zdCBzaGlwID0gbWFwcGVyLmdldChzaGlwQ29tcG9uZW50KTtcbiAgICAgIGNvbnN0IG5ld2RpciA9IHtcbiAgICAgICAgIHg6IDEgLSBzaGlwLm9yaWVudGF0aW9uLngsXG4gICAgICAgICB5OiAxIC0gc2hpcC5vcmllbnRhdGlvbi55XG4gICAgICB9O1xuXG4gICAgICBQbGFjZW1lbnRIYW5kbGVyLnRyeVRvUGxhY2Uoc2hpcCwgYm9hcmQsIHNoaXAuY29vcmRpbmF0ZXNbMF0sIG5ld2Rpcik7XG5cbiAgICAgIHNoaXBDb21wb25lbnQuc3R5bGUud2lkdGggPSBgJHtNYXRoLm1heChcbiAgICAgICAgIGNlbGxTaXplLFxuICAgICAgICAgc2hpcC5vcmllbnRhdGlvbi55ICogc2hpcC5sZW5ndGggKiBjZWxsU2l6ZVxuICAgICAgKX1weGA7XG4gICAgICBzaGlwQ29tcG9uZW50LnN0eWxlLmhlaWdodCA9IGAke01hdGgubWF4KFxuICAgICAgICAgY2VsbFNpemUsXG4gICAgICAgICBzaGlwLm9yaWVudGF0aW9uLnggKiBzaGlwLmxlbmd0aCAqIGNlbGxTaXplXG4gICAgICApfXB4YDtcbiAgIH1cbn1cblxuZnVuY3Rpb24gZmluZFN0YXJ0Q2VsbCgpIHtcbiAgIGxldCBtaW5EaXN0ID0gSW5maW5pdHk7XG4gICBjb25zdCBtYXhNaW5EaXN0ID0gNjA7XG5cbiAgIENlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgIGNvbnN0IGRpc3QgPVxuICAgICAgICAgTWF0aC5hYnMoXG4gICAgICAgICAgICBjZWxsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnggLSBjdXJyU2hpcC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS54XG4gICAgICAgICApICtcbiAgICAgICAgIE1hdGguYWJzKFxuICAgICAgICAgICAgY2VsbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS55IC0gY3VyclNoaXAuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueVxuICAgICAgICAgKTtcbiAgICAgIGlmIChkaXN0IDwgbWluRGlzdCkge1xuICAgICAgICAgc3RhcnRDZWxsID0gY2VsbDtcbiAgICAgICAgIG1pbkRpc3QgPSBkaXN0O1xuICAgICAgfVxuICAgfSk7XG5cbiAgIGlmIChtaW5EaXN0ID4gbWF4TWluRGlzdCkgcmV0dXJuIG51bGw7XG5cbiAgIHJldHVybiBzdGFydENlbGw7XG59XG5cbmZ1bmN0aW9uIGlzUGxhY2VhYmxlKGNlbGwsIHNoaXBDb21wb25lbnQpIHtcbiAgIGNvbnN0IHN0cnRDZWxsID0gW051bWJlcihjZWxsLmRhdGFzZXQueCksIE51bWJlcihjZWxsLmRhdGFzZXQueSldO1xuICAgY29uc3Qgc2hpcCA9IG1hcHBlci5nZXQoc2hpcENvbXBvbmVudCk7XG4gICByZXR1cm4gUGxhY2VtZW50SGFuZGxlci50cnlUb1BsYWNlKHNoaXAsIGJvYXJkLCBzdHJ0Q2VsbCwgc2hpcC5vcmllbnRhdGlvbik7XG59XG5cbmZ1bmN0aW9uIGhpZ2hsaWdodENlbGxzKGNlbGwpIHtcbiAgIGlmIChjZWxsKSB7XG4gICAgICBjb25zdCByZXFsZW5ndGggPSBtYXBwZXIuZ2V0KGN1cnJTaGlwKS5sZW5ndGg7XG4gICAgICBjb25zdCBuZWFyYnlDZWxscyA9IGdldE5lYXJieUNlbGxzKGNlbGwsIHJlcWxlbmd0aCk7XG5cbiAgICAgIGlmIChuZWFyYnlDZWxscy5sZW5ndGggPT09IHJlcWxlbmd0aCkge1xuICAgICAgICAgbmVhcmJ5Q2VsbHMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodCcpO1xuICAgICAgICAgfSk7XG4gICAgICAgICBjdXJyU2hpcC5jbGFzc0xpc3QucmVtb3ZlKCdub3RwbGFjZWFibGUnKTtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgIH1cblxuICAgY3VyclNoaXAuY2xhc3NMaXN0LmFkZCgnbm90cGxhY2VhYmxlJyk7XG59XG5cbmZ1bmN0aW9uIGdldE5lYXJieUNlbGxzKGNlbGwsIGxlbmd0aCkge1xuICAgY29uc3QgY2VsbExpc3QgPSBbXTtcblxuICAgaWYgKCFjZWxsKSByZXR1cm4gY2VsbExpc3Q7XG5cbiAgIGNvbnN0IHN0cnR4ID0gTnVtYmVyKGNlbGwuZGF0YXNldC54KTtcbiAgIGNvbnN0IHN0cnR5ID0gTnVtYmVyKGNlbGwuZGF0YXNldC55KTtcbiAgIGNvbnN0IGN1cnJEaXIgPSBtYXBwZXIuZ2V0KGN1cnJTaGlwKS5vcmllbnRhdGlvbjtcblxuICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgY29uc3QgbnggPSBzdHJ0eCArIGkgKiBjdXJyRGlyLng7XG4gICAgICBjb25zdCBueSA9IHN0cnR5ICsgaSAqIGN1cnJEaXIueTtcblxuICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS14PVwiJHtueH1cIl1bZGF0YS15PVwiJHtueX1cIl1gKTtcbiAgICAgIGlmIChlbCAmJiBib2FyZFtueF1bbnldID09PSBudWxsKSBjZWxsTGlzdC5wdXNoKGVsKTtcbiAgIH1cblxuICAgcmV0dXJuIGNlbGxMaXN0O1xufVxuXG5mdW5jdGlvbiBjbGVhckhpZ2hsaWdodCgpIHtcbiAgIGNvbnN0IGhpZ2hsaWdodGVkQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaGlnaGxpZ2h0Jyk7XG4gICBoaWdobGlnaHRlZENlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0Jyk7XG4gICB9KTtcbn1cblxuZXhwb3J0IHsgZW5hYmxlRHJhZ0Ryb3AsIGRpc2FibGVEcmFnRHJvcCB9O1xuIiwiaW1wb3J0IHtpbml0fSBmcm9tICcuL21vZHVsZXMvZG9tJztcbmltcG9ydCBQbGF5ZXIgZnJvbSAnLi9tb2R1bGVzL3BsYXllcic7XG5pbXBvcnQgeyBlbmFibGVEcmFnRHJvcCB9IGZyb20gJy4vbW9kdWxlcy9kcmFnX2Ryb3AnO1xuXG5pbml0KCk7XG5cbmNvbnN0IHBsYXllciA9IG5ldyBQbGF5ZXIoJ3BsYXllcicpO1xuZW5hYmxlRHJhZ0Ryb3AocGxheWVyLmdhbWVib2FyZCk7IiwiaW1wb3J0IEdhbWVCb2FyZCBmcm9tIFwiLi9nYW1lYm9hcmRcIjtcblxuY2xhc3MgUGxheWVyIHtcbiAgICBjb25zdHJ1Y3RvcihuYW1lKXtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy5nYW1lYm9hcmQgPSBuZXcgR2FtZUJvYXJkKCk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQbGF5ZXI7Il0sIm5hbWVzIjpbImNvbnN0cnVjdG9yIiwibmFtZSIsImxlbmd0aCIsInRoaXMiLCJoZWFsdGgiLCJjb29yZGluYXRlcyIsIm9yaWVudGF0aW9uIiwiaGl0IiwiaXNTdW5rIiwiZGlycyIsIngiLCJ5Iiwic2VsZWN0UmFuZG9tIiwiYXJyYXkiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJnZXRSYW5kb21Db2xvciIsImNoZWNrQm91bmQiLCJib2FyZCIsInBsYXllckJvYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29tcHV0ZXJCb2FyZCIsImNyZWF0ZUNlbGwiLCJpIiwiaiIsImNlbGwiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiZGF0YXNldCIsImNyZWF0ZUdyaWQiLCJjb250YWluZXIiLCJhcHBlbmRDaGlsZCIsInBsYWNlUmFuZG9tIiwiU2hpcHMiLCJxdWV1ZSIsInNoaXAiLCJzaGlmdCIsInRyeVRvUGxhY2UiLCJwdXNoIiwic3RydENlbGwiLCJkaXIiLCJlbXB0eUNlbGxzIiwiZ2V0UmFuZG9tRW1wdHlDZWxsIiwicHJldkNvb3JkcyIsImZvckVhY2giLCJuZXdDb29yZHMiLCJjZWxscyIsInBvc1giLCJwb3NZIiwiYm9hcmRTaXplIiwiY3JlYXRlYm9hcmQiLCJwbGFjZVNoaXBzUmFuZG9tbHkiLCJzaXplIiwiQXJyYXkiLCJmaWxsIiwibWFwIiwicGxhY2VTaGlwQXQiLCJhcmVTaGlwc1N1bmsiLCJzb21lIiwicmVjZWl2ZUF0dGFjayIsImdldFNoaXBzIiwiZ2V0Qm9hcmQiLCJDZWxscyIsIm1hcHBlciIsIk1hcCIsImN1cnJTaGlwIiwiaW5pdGlhbFgiLCJpbml0aWFsWSIsImlzZHJhZ2dpbmciLCJzdGFydENlbGwiLCJoYW5kbGVEcmFnU3RhcnQiLCJlIiwidGFyZ2V0Iiwic3R5bGUiLCJyZW1vdmVQcm9wZXJ0eSIsImNsaWVudFgiLCJjbGllbnRZIiwiaGFuZGxlRHJhZ0VuZCIsInJlbW92ZSIsImxlZnQiLCJ0b3AiLCJzaGlwQ29tcG9uZW50IiwiTnVtYmVyIiwiZ2V0IiwiaXNQbGFjZWFibGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJjbGVhckhpZ2hsaWdodCIsImhhbmRsZURyYWdnaW5nIiwiZmluZFN0YXJ0Q2VsbCIsInJlcWxlbmd0aCIsIm5lYXJieUNlbGxzIiwiY2VsbExpc3QiLCJzdHJ0eCIsInN0cnR5IiwiY3VyckRpciIsIm54IiwibnkiLCJlbCIsImdldE5lYXJieUNlbGxzIiwiaGlnaGxpZ2h0Q2VsbHMiLCJyb3RhdGVTaGlwIiwiYnV0dG9uIiwiY2VsbFNpemUiLCJuZXdkaXIiLCJ3aWR0aCIsIm1heCIsImhlaWdodCIsIm1pbkRpc3QiLCJJbmZpbml0eSIsImRpc3QiLCJhYnMiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZ2FtZWJvYXJkIiwiY2xlYXIiLCJjcmVhdGVTaGlwQ29tcG9uZW50Iiwic2V0Iiwia2V5cyIsImFkZEV2ZW50TGlzdGVuZXIiLCJwcmV2ZW50RGVmYXVsdCIsImVuYWJsZURyYWdEcm9wIl0sInNvdXJjZVJvb3QiOiIifQ==